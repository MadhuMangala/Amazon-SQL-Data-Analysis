------------------
Good to Know 
---------------
1) Total Sales / Total Revenue / Total orders Value = sum ( qty * price per item )
2) AOV = total order  qty / total sales. 








ðŸŸ¢.Q.1. Top Selling Products Query the top 10 products by total sales value.
Challenge: Include product name, total quantity sold, and total sales value.
--------------
Solution :-
--------------
select prd.product_name,
sum(ord_itm.quantity) as total_quantity,
round(sum(ord_itm.price_per_unit*ord_itm.quantity),2) as total_sales from order_items as ord_itm
join products prd
using(product_id)
group by prd.product_name 
order by total_sales desc limit 10
===============================================================================================================================================================
ðŸŸ¢.Q.2. Revenue by Category Calculate total revenue generated by each product category.
 Challenge: Include the percentage contribution of each category to total revenue.

--------------
Solution :-
--------------
with total_revenue_by_categ.ory as (
SELECT ctrg.category_name,
round(sum(ord_itm.quantity*
ord_itm.price_per_unit),2) as total_revenue_per_category
-- as wnd
FROM amazon.order_items as ord_itm
join products as prd
using(product_id)
join category as ctrg
using(category_id)
group by ctrg.category_name
)

select *,
round((total_revenue_per_category / 
(sum(total_revenue_per_category) over())*100),2) 
as Contribution_by_Category
from total_revenue_by_category
=====================================================================================================================================================================

ðŸŸ¢.Q.3. Average Order Value (AOV) Compute the average order value for each customer.
Challenge: Include only customers with more than 5 orders.
Total Revenue = Qty * price item.
AOV= TotalÂ Revenue/TotalÂ NumberÂ ofÂ Orders 
â€‹
--------------
Solution :-
--------------

SELECT c.customer_id,
round((sum(ord_itm.quantity * ord_itm.price_per_unit)
/ count(ord_itm.order_id)),2) as AOV 
FROM amazon.orders as ord
join order_items as ord_itm
using(order_id)
join customers c
using(customer_id)
group by c.customer_id
having(count(ord_itm.order_id)>5)
order by customer_id

===========================================================================================================================================================================
ðŸŸ¢.Q.4. Monthly Sales Trend :- Query monthly total sales over the past year.
Challenge: Display the sales trend, grouping by month, return current_month sale, last month sale!

--------------
Solution :-
--------------

select month(ord.order_date),year(ord.order_date),
round(sum(ord_itm.quantity*ord_itm.price_per_unit),2) as monthly_total_sales,
lag(round(sum(ord_itm.quantity*ord_itm.price_per_unit),2),1,0) over(order by year(ord.order_date),month(ord.order_date)) as prv_month
from
order_items as ord_itm
join orders ord
using(order_id)
where ord.order_date >= date_add(current_date(),interval -12 month)
group by month(ord.order_date),year(ord.order_date)

===============================================================================================================================================================================
ðŸŸ¢.Q.5. Customers with No Purchases Find customers who have registered but never placed an order.
Challenge: List customer details and the time since their registration.

--------------
Solution :-
--------------
select * from
customers where customer_id not in (
select customer_id from
orders as ord_itm
)

===================================================================================================================================================================================

ðŸŸ¢.Q.6.Least-Selling Categories by State
Identify the least-selling product category for each state.
Challenge: Include the total sales for that category within each state.

--------------
Solution :-
--------------

with cte as (
select 
c.category_name,cust.state,
round(sum(ord_itm.quantity*ord_itm.price_per_unit),2) as total_sales,
dense_rank() over(partition by cust.state order by sum(ord_itm.quantity*ord_itm.price_per_unit)) as rnk
from order_items as ord_itm
join orders as ords
using(order_id)
join customers as cust
using(customer_id)
join products as p
using(product_id)
join category as c
using(category_id)
group by 1,2
)
select state as state,category_name as least_seiing_category,total_sales
from cte where rnk <= 1

======================================================================================================================================================================================

ðŸŸ¢.Q.7. Customer Lifetime Value (CLTV)
Calculate the total value of orders placed by each customer over their lifetime.
Challenge: Rank customers based on their CLTV.
--------------
Solution :-
--------------

