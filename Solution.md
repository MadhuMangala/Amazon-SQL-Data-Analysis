## **Good To Know**
```
1) Total Sales / Total Revenue / Total orders Value = sum ( qty * price per item )
2) AOV = total order  qty / total sales.
3) Profit Margin  = total_price_product(i.e qty * price_per_item) - total_cogs (i.e qty * cogs)
4) order means either it may be order units or order_ids , if they did not mentions anythings else,
    then select any one from the above.
```


ðŸŸ¢.Q.1. Top Selling Products Query the top 10 products by total sales value.
Challenge: Include product name, total quantity sold, and total sales value.

### Solutions Implemented:
```sql
select prd.product_name,
sum(ord_itm.quantity) as total_quantity,
round(sum(ord_itm.price_per_unit*ord_itm.quantity),2) as total_sales from order_items as ord_itm
join products prd
using(product_id)
group by prd.product_name 
order by total_sales desc limit 10
```

ðŸŸ¢.Q.2. Revenue by Category Calculate total revenue generated by each product category.
 Challenge: Include the percentage contribution of each category to total revenue.

### Solutions Implemented:
```sql
with total_revenue_by_categ.ory as (
SELECT ctrg.category_name,
round(sum(ord_itm.quantity*
ord_itm.price_per_unit),2) as total_revenue_per_category
-- as wnd
FROM amazon.order_items as ord_itm
join products as prd
using(product_id)
join category as ctrg
using(category_id)
group by ctrg.category_name
)

select *,
round((total_revenue_per_category / 
(sum(total_revenue_per_category) over())*100),2) 
as Contribution_by_Category
from total_revenue_by_category
```


ðŸŸ¢.Q.3. Average Order Value (AOV) Compute the average order value for each customer.
Challenge: Include only customers with more than 5 orders.
Total Revenue = Qty * price item.
AOV= TotalÂ Revenue/TotalÂ NumberÂ ofÂ Orders 
â€‹
### Solutions Implemented:
```sql

SELECT c.customer_id,
round((sum(ord_itm.quantity * ord_itm.price_per_unit)
/ count(ord_itm.order_id)),2) as AOV 
FROM amazon.orders as ord
join order_items as ord_itm
using(order_id)
join customers c
using(customer_id)
group by c.customer_id
having(count(ord_itm.order_id)>5)
order by customer_id
```
---
ðŸŸ¢.Q.4. Monthly Sales Trend :- Query monthly total sales over the past year.
Challenge: Display the sales trend, grouping by month, return current_month sale, last month sale!

### Solutions Implemented:
```sql

select month(ord.order_date),year(ord.order_date),
round(sum(ord_itm.quantity*ord_itm.price_per_unit),2) as monthly_total_sales,
lag(round(sum(ord_itm.quantity*ord_itm.price_per_unit),2),1,0) over(order by year(ord.order_date),month(ord.order_date)) as prv_month
from
order_items as ord_itm
join orders ord
using(order_id)
where ord.order_date >= date_add(current_date(),interval -12 month)
group by month(ord.order_date),year(ord.order_date)
```

ðŸŸ¢.Q.5. Customers with No Purchases Find customers who have registered but never placed an order.
Challenge: List customer details and the time since their registration.

### Solutions Implemented:
```sql
select * from
customers where customer_id not in (
select customer_id from
orders as ord_itm
)
```

ðŸŸ¢.Q.6.Least-Selling Categories by State
Identify the least-selling product category for each state.
Challenge: Include the total sales for that category within each state.

### Solutions Implemented:
```sql
with cte as (
select 
c.category_name,cust.state,
round(sum(ord_itm.quantity*ord_itm.price_per_unit),2) as total_sales,
dense_rank() over(partition by cust.state order by sum(ord_itm.quantity*ord_itm.price_per_unit)) as rnk
from order_items as ord_itm
join orders as ords
using(order_id)
join customers as cust
using(customer_id)
join products as p
using(product_id)
join category as c
using(category_id)
group by 1,2
)
select state as state,category_name as least_seiing_category,total_sales
from cte where rnk <= 1
```

ðŸŸ¢.Q.7. Customer Lifetime Value (CLTV)
Calculate the total value of orders placed by each customer over their lifetime.
Challenge: Rank customers based on their CLTV.
### Solutions Implemented:
```sql
select c.first_name,c.last_name,
round(sum(ord_itm.quantity*ord_itm.price_per_unit),2) as total_order_value,
dense_rank() over w as rnk
from order_items as ord_itm
join orders as ord
using(order_id)
left join customers as c
using(customer_id)
group by c.first_name,c.last_name
window w as (order by round(sum(ord_itm.quantity*ord_itm.price_per_unit),2) desc)

```
---
![image](https://github.com/user-attachments/assets/749d0635-057b-47e8-8a98-4b577198b8d4)

---

ðŸŸ¢.Q.8. Inventory Stock Alerts
Query products with stock levels below a certain threshold (e.g., less than 10 units).
Challenge: Include last restock date and warehouse information.

### Solutions Implemented:
``` SQL
SELECT inv.product_id,inv.stock,inv.warehouse_id,inv.last_stock_date,
p.product_name 
FROM amazon.inventory inv
join products as p
using(product_id)
where stock < 10
```
---
![image](https://github.com/user-attachments/assets/72501b5e-edb4-489e-96ca-a39fc13196d2)
---
ðŸŸ¢.Q.9. Shipping Delays
Identify orders where the shipping date is later than 3 days after the order date.
Challenge:customer_id,product_id,order_Date,shipping_date,delays_in_days,product_name,delivery_status

### Solutions Implemented:
``` SQL
/* Shipping Delays
Identify orders where the shipping date is later than 3 days after the order date.
Challenge: Include customer, order details, and delivery provider.
*/

with cte as (
SELECT ord.customer_id,ord_itm.product_id,p.product_name,
ord_itm.order_id,ord.order_date,
ship.shipping_date,
datediff(ship.shipping_date,ord.order_date) as shipping_delays,
ship.delivery_status
FROM amazon.order_items as ord_itm
join orders as ord
using(order_id)
join products as p
using(product_id)
join shipping as ship
using(order_id)
)

select * from cte where shipping_delays > 3
```
---
![image](https://github.com/user-attachments/assets/92fb49ab-ec35-4439-95db-996950191cc8)
---
ðŸŸ¢.Q.10. Payment Success Rate 
Calculate the percentage of successful payments across all orders.
Challenge: Include breakdowns by payment status (e.g., failed, pending).
### Solutions Implemented:
``` SQL
select payment_status ,count(payment_id) as payments_status_count,
sum(count(payment_id))over() as total_paymanets,
round((count(payment_id) /sum(count(payment_id))over())*100,2) as payment_status_contribution
from payments
group by payment_status

```
---
![image](https://github.com/user-attachments/assets/20fbf839-5df8-4948-b5c7-caeded0a9a64)

---
ðŸŸ¢.Q.11. Top Performing Sellers
Find the top 5 sellers based on total sales value.
Challenge: Include both successful and failed orders, and display their percentage of successful orders.
### Solutions Implemented:
``` SQL
--  Top Performing Sellers
-- Find the top 5 sellers based on total sales value.
-- Include both successful and failed orders, and display their percentage of successful orders.
with cte as (
select s.seller_id,
round(sum(ord_itm.quantity*ord_itm.price_per_unit),2) as total_sales_by_seller,
count(case when order_status = "Cancelled" then 1 else null end) as cancelled_orders_cnt,
count(case when order_status = "Completed" then 1 else null end) as Completed_orders_cnt,
count(ord_itm.order_id) as total_orders_cnt 
from order_items as ord_itm
join orders as ord
using(order_id)
join sellers as s
using(seller_id)
-- where order_status in ("Completed","Cancelled")
group by s.seller_id
order by s.seller_id , total_sales_by_seller desc limit 5
)

select *,
round((Completed_orders_cnt/total_orders_cnt)*100,2) as successful_orders_contribution
from cte
-- order by total_sales_by_seller desc limit 5

```
---
![image](https://github.com/user-attachments/assets/2c8efd00-cdd1-4286-9a22-8c87a4658c74)
---

ðŸŸ¢.Q.12. Product Profit Margin
Calculate the total profit margin for each product (difference between price and cost of goods sold).
Challenge: Rank products by their profit margin,total_sales,_total_cogs,profit_margin_%, showing highest to lowest.
### Solutions Implemented:
``` SQL
/*
12. Product Profit Margin
Calculate the profit margin for each ordered product (difference between price and cost of goods sold).
Challenge: Rank products by their profit margin, showing highest to lowest.
*/
with cte as (
select ord_itm.product_id,p.product_name,
round((ord_itm.quantity * ord_itm.price_per_unit),2) as total_sales,
round((ord_itm.quantity * p.cogs),2) as total_cogs
from order_items as ord_itm
join products as p
using(product_id)
-- where ord_itm.product_id = 2
),
PandL_values as (
select product_id,product_name,
round(sum(total_sales),2) as total_sales,
round(sum(total_cogs),2) as total_cogs,
round((sum(total_sales) - sum(total_cogs)),2) as total_profit_margin,
round(((sum(total_sales) - sum(total_cogs)) 
/sum(total_sales))*100,2) as profit_margin_percent
from cte 
group by 1,2
)
select *,dense_rank()over(order by profit_margin_percent desc) as rnk from PandL_values
```
---
![image](https://github.com/user-attachments/assets/7f42f734-abd1-4e62-9f04-bc341abd7022)
---

ðŸŸ¢.Q.13.Most Returned Products
Query the top 10 products by the number of returns.
Challenge: Display the return rate as a percentage of total units sold for each product.
### Solutions Implemented:
``` SQL
with cte as
(
select ord_itm.product_id,p.product_name,
sum(ord_itm.quantity) as total_order_qunatity,
sum(case when ord.order_status = "Returned" then ord_itm.quantity else null end) as total_return_prd_cnt
from order_items as ord_itm
join orders as ord
using(order_id)
join products as p
using(product_id)
group by 1,2
order by total_return_prd_cnt desc
limit 10
)
select *,
round((total_return_prd_cnt/total_order_qunatity)*100,2) as return_rate
from cte
```
---
![image](https://github.com/user-attachments/assets/d90d54c2-d08f-4792-a648-f8e80eb581a9)
---
ðŸŸ¢.Q.14.Orders Pending Shipment
Find orders that have been paid but are still pending shipment.
Challenge: Include order details, payment date, and customer information.
### Solutions Implemented:
```sql
select * from orders as
ord
join customers as cust
using(customer_id)
join payments as pymnt
using(order_id)
where pymnt.payment_status = "Payment Successed"
	and ord.order_status = "Inprogress"
```
---
![image](https://github.com/user-attachments/assets/e02eca95-1f1e-4ce8-9b13-12734cb6f8e3)
---
ðŸŸ¢.Q.15. Inactive Sellers
Identify sellers who havenâ€™t made any sales in the last 6 months.
Challenge: Show the last sale date and total sales from those sellers
```sql
with no_sales_seller_ids as(
select seller_id from sellers
where seller_id not in (
select seller_id from orders as ord
where order_date >= date_add(current_date(),interval -6 month)
))
select ord.seller_id,
round(sum(ord_itm.quantity*ord_itm.price_per_unit),2)as total_sales
,max(order_date) as last_sales_date
from orders as ord
join order_items as ord_itm
using(order_id)
where ord.seller_id in (select seller_id from no_sales_seller_ids)
group by ord.seller_id

```
---
No Sales made by seller id 53,54 from last one year.
---
ðŸŸ¢.Q.16. IDENTITY customers into returning or new
if the customer has done more than 5 return (based on order cnt not unit) categorize them as returning otherwise new
Challenge: List customers id, name, total orders, total returns
```sql
with cte as ( 
select cust.customer_id,
concat_ws(" ",cust.first_name,cust.last_name) as name,
count(ord.order_id) as total_orders,
sum(case when ord.order_status="Returned" then 1 else 0 end) as total_returns
-- sum(case when ord.order_status = "%Returned%" then 1 else 0 end) as total_returns 
from orders as ord
join customers as cust
using(customer_id)
group by 1,2
order by  total_returns desc
)

select *,
case when total_returns >= 5 then "Returning" else "New" end as "return status"
from cte

```
---
![image](https://github.com/user-attachments/assets/1ded3431-6191-485b-b61c-a16e1b1be855)
---
ðŸŸ¢.Q.17.Revenue by Shipping Provider Calculate the total revenue handled by each shipping provider.
Challenge: Include the total number of orders(units) handled and the average delivery time for each provider
```sql
select shpng.shiping_provider,
sum(ord_itm.quantity) as total_orders,
round(sum(ord_itm.quantity*ord_itm.price_per_unit),2) as total_revenue ,
avg(datediff(shpng.shipping_date,ord.order_date)) as avg_delivery_time
from order_items as ord_itm
join orders ord
using(order_id) 
join shipping as shpng
using(order_id)
group by shpng.shiping_provider
```
---
![image](https://github.com/user-attachments/assets/ed79f0b0-0338-45ca-be54-7b24e3ec2ada)
---
ðŸŸ¢.Q.18. Top 5 Customers by Orders in Each State
Identify the top 5 customers with the highest number of orders (units)for each state.
Challenge: Include the number of orders and total sales for each customer.
```sql
with customer_ord_information as (
select cust.state,cust.first_name,cust.last_name
,sum(ord_itm.quantity) as total_order_units,
dense_rank()over(partition by cust.state order by sum(ord_itm.quantity) desc) as rnk
from orders as ord
join order_items as ord_itm
using(order_id)
join customers as cust
using(customer_id)
group by 1,2,3
)

select * from customer_ord_information
where rnk <= 5
```


![image](https://github.com/user-attachments/assets/c0c061a6-152d-49b6-b5cc-c2664d180d9a)
---



